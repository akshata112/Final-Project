
// if (typeof web3 !== 'undefined') {
//     web3 = new Web3(web3.currentProvider);
// } else {
//     // set the provider you want from Web3.providers
// web3 = new Web3(new Web3.providers.HttpProvider("http://127.0.0.1:8545"));
// }

var web3;

var agentContractAddress = '0x4e4f37a6Bdb699Fe3f5E0DF979a89bFE32Aa78f5';

function connect(){
    web3 = new Web3(window.ethereum)
    window.ethereum.enable().catch(error => {
        // User denied account access
        console.log(error);
    })
    abi = JSON.parse('[ { "constant": true, "inputs": [ { "name": "", "type": "uint256" } ], "name": "doctorList", "outputs": [ { "name": "", "type": "address" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "", "type": "address" } ], "name": "doctorInfo", "outputs": [ { "name": "name", "type": "string" }, { "name": "age", "type": "uint256" }, { "name": "occupation", "type": "string" }, { "name": "phonenumber", "type": "string" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "", "type": "address" } ], "name": "patientRecords", "outputs": [ { "name": "", "type": "string" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "", "type": "address" } ], "name": "patientInfo", "outputs": [ { "name": "name", "type": "string" }, { "name": "age", "type": "uint256" }, { "name": "guardian", "type": "string" }, { "name": "phonenumber", "type": "string" }, { "name": "record", "type": "string" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "", "type": "address" }, { "name": "", "type": "uint256" } ], "name": "patientDocuments", "outputs": [ { "name": "ipfshash1", "type": "string" }, { "name": "ipfshash2", "type": "string" }, { "name": "ipfshash3", "type": "string" }, { "name": "ipfshash4", "type": "string" }, { "name": "filename", "type": "string" }, { "name": "timeAdded", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "", "type": "uint256" } ], "name": "patientList", "outputs": [ { "name": "", "type": "address" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "", "type": "address" } ], "name": "Empty", "outputs": [ { "name": "", "type": "address" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "_name", "type": "string" }, { "name": "_age", "type": "uint256" }, { "name": "_guardian", "type": "string" }, { "name": "_phonenumber", "type": "string" }, { "name": "_designation", "type": "uint256" }, { "name": "_hash", "type": "string" } ], "name": "add_agent", "outputs": [ { "name": "", "type": "string" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [ { "name": "addr", "type": "address" } ], "name": "get_patient", "outputs": [ { "name": "", "type": "string" }, { "name": "", "type": "uint256" }, { "name": "", "type": "string" }, { "name": "", "type": "string" }, { "name": "", "type": "uint256[]" }, { "name": "", "type": "address" }, { "name": "", "type": "string" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "addr", "type": "address" } ], "name": "get_doctor", "outputs": [ { "name": "", "type": "string" }, { "name": "", "type": "uint256" }, { "name": "", "type": "string" }, { "name": "", "type": "string" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "paddr", "type": "address" }, { "name": "daddr", "type": "address" } ], "name": "get_patient_doctor_name", "outputs": [ { "name": "", "type": "string" }, { "name": "", "type": "string" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "addr", "type": "address" } ], "name": "permit_access", "outputs": [], "payable": true, "stateMutability": "payable", "type": "function" }, { "constant": false, "inputs": [ { "name": "paddr", "type": "address" }, { "name": "_diagnosis", "type": "string" }, { "name": "_hash", "type": "string" } ], "name": "insurance_claim", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [ { "name": "paddr", "type": "address" }, { "name": "daddr", "type": "address" } ], "name": "remove_patient", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [ { "name": "addr", "type": "address" } ], "name": "get_accessed_doctorlist_for_patient", "outputs": [ { "name": "", "type": "address[]" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "addr", "type": "address" } ], "name": "get_accessed_patientlist_for_doctor", "outputs": [ { "name": "", "type": "address[]" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "daddr", "type": "address" } ], "name": "revoke_access", "outputs": [], "payable": true, "stateMutability": "payable", "type": "function" }, { "constant": true, "inputs": [], "name": "get_patient_list", "outputs": [ { "name": "", "type": "address[]" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "get_doctor_list", "outputs": [ { "name": "", "type": "address[]" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "paddr", "type": "address" } ], "name": "get_hash", "outputs": [ { "name": "", "type": "string" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "patientAddress", "type": "address" }, { "name": "_ipfshash1", "type": "string" }, { "name": "_ipfshash2", "type": "string" }, { "name": "_ipfshash3", "type": "string" }, { "name": "_ipfshash4", "type": "string" }, { "name": "_filename", "type": "string" } ], "name": "addPatientDocument", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [ { "name": "patientAddress", "type": "address" } ], "name": "getPatientDocuments1", "outputs": [ { "name": "", "type": "string[]" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "patientAddress", "type": "address" } ], "name": "getPatientDocuments2", "outputs": [ { "name": "", "type": "string[]" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "patientAddress", "type": "address" } ], "name": "getPatientDocuments3", "outputs": [ { "name": "", "type": "string[]" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "patientAddress", "type": "address" } ], "name": "getPatientDocuments4", "outputs": [ { "name": "", "type": "string[]" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "patientAddress", "type": "address" } ], "name": "getPatientDocumentsname", "outputs": [ { "name": "", "type": "string[]" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "patientAddress", "type": "address" } ], "name": "getPatientDocumentstime", "outputs": [ { "name": "", "type": "uint256[]" } ], "payable": false, "stateMutability": "view", "type": "function" } ]');
    AgentContract = web3.eth.contract(abi);
    contractInstance = AgentContract.at(agentContractAddress);   
    web3.eth.defaultAccount = web3.currentProvider.selectedAddress;
    console.log("Web3 Connected:"+ web3.eth.defaultAccount );
    return web3.currentProvider.selectedAddress;
}
    
window.addEventListener('load', async () => {
    // New web3 provider
    connect();
    console.log("Externally Loaded!");
});